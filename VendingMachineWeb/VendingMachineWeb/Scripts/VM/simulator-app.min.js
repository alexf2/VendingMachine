define("simulator-app",["jquery","knockoutjs","wallet","goods-store","purcashing-result","wallet-plugin","vending-machine-plugin"],function(n,t,i,r,u){"use strict";function o(){return"."+a}function s(n){return n+o()}function v(){function o(){c.call(u,!0)}function s(){c.call(u,!1)}function h(t){try{u.customerWallet=new i("uw","User's wallet",t.customerWallet);u.customerWallet.getUserWallet$.call(u).wallet_p({template:u.templatesBaseUrl+"wallet-template.html",wallet:u.customerWallet});var f=new i("mw","VM's wallet",t.vendingMachine.wallet,!0);k.call(u).wallet_p({readonly:!0,template:u.templatesBaseUrl+"wallet-template.html",wallet:f});e.call(u).vending_machine_p({goodsTemplate:u.templatesBaseUrl+"goods-template.html",wallet:f,goods:new r(t.vendingMachine.goods,f),id:"vm1"})}catch(o){n('<div class="err-msg"><\/div>').prependTo(document.body).text("Simulator initialization error: "+o.message)}}function l(t,i,r){n('<div class="err-msg"><\/div>').prependTo(document.body).text("Can not load template - "+i+": '"+r+"'")}var u=this,f;t.applyBindings(this,d.call(this).get(0));f={url:this.modelUrl,dataType:"json",beforeSend:o,type:"GET"};n.ajax(f).always(s).done(h).fail(l)}function y(){l.call(this).on(s("money-item-clicked"),n.proxy(p,this));e.call(this).on(s("purchase-result"),n.proxy(w,this)).on(s("money-refund"),n.proxy(b,this))}function c(t){t?n(document.body).has(".list-ajax-loader").length==0&&n('<div class="list-ajax-loader" />').prependTo(n(document.body)):n(document.body).find(".list-ajax-loader").remove()}function f(n){this.logMessages.push(n)}function p(n,t){var r={nominal:t,amount:1},i=this.customerWallet.withdraw(r);return i===!0?(e.call(this).data("vending_machine_p").cashIn(r),f.call(this,"Deposit "+t)):f.call(this,"Can not withdrow "+i.nominal+": uderflow "+i.amountDiff),!1}function w(n,t){return t.result.status===u.prototype.SOLD_OK?(f.call(this,t.merch.name+"/"+t.merch.price+"R was purchased"),t.result.change&&(this.customerWallet.deposit(t.result.change),f.call(this,"Change refunded: "+this.customerWallet.getBalance(t.result.change)+"R"))):t.result.status===u.prototype.RUN_OUT?f.call(this,"Purchasing failed: selected goods item has finished"):t.result.status===u.prototype.NOT_ENOUGHT_MONEY?f.call(this,"Purchasing failed: the deposit is not enough"):t.result.status===u.prototype.NO_CHANGE&&f.call(this,"Purchasing failed: VM does not have enough change"),!1}function b(n,t){return this.customerWallet.deposit(t.items),f.call(this,"Money refunded: "+this.customerWallet.getBalance(t.items)+" R"),!1}function l(){return n(".id-user-wallet")}function k(){return n(".id-machine-wallet")}function e(){return n(".id-machine")}function d(){return n(".id-msg-log")}var a="SimulatorApp",h=function(n,i){this.modelUrl=n;this.templatesBaseUrl=i;this.logMessages=t.observableArray()};return h.prototype={run:function(){v.call(this);y.call(this)},clearLog:function(){this.logMessages([])}},h});
//# sourceMappingURL=simulator-app.min.js.map