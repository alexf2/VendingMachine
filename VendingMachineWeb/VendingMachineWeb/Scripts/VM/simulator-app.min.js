!function(n){"use strict";function u(){return"."+h}function f(n){return n+u()}function l(){function f(){s.call(i,!0)}function o(){s.call(i,!1)}function h(u){try{i.customerWallet=new t.Wallet("uw","User's wallet",u.customerWallet);e.call(i).walletp({template:i.templatesBaseUrl+"wallet-template.html",wallet:i.customerWallet});var f=new t.Wallet("mw","VM's wallet",u.vendingMachine.wallet,!0);w.call(i).walletp({readonly:!0,template:i.templatesBaseUrl+"wallet-template.html",wallet:f});r.call(i).vending_machine({goodsTemplate:i.templatesBaseUrl+"goods-template.html",wallet:f,goods:new t.GoodsStore(u.vendingMachine.goods,f),id:"vm1"})}catch(o){n('<div class="err-msg"><\/div>').prependTo(document.body).text("Simulator initialization error: "+o.message)}}function c(t,i,r){n('<div class="err-msg"><\/div>').prependTo(document.body).text("Can not load template - "+i+": '"+r+"'")}var i=this,u;ko.applyBindings(this,b.call(this).get(0));u={url:this.modelUrl,dataType:"json",beforeSend:f,type:"GET"};n.ajax(u).always(o).done(h).fail(c)}function a(){e.call(this).on(f("money-item-clicked"),n.proxy(v,this));r.call(this).on(f("purchase-result"),n.proxy(y,this)).on(f("money-refund"),n.proxy(p,this))}function s(t){t?n(document.body).has(".list-ajax-loader").length==0&&n('<div class="list-ajax-loader" />').prependTo(n(document.body)):n(document.body).find(".list-ajax-loader").remove()}function i(n){this.logMessages.push(n)}function v(n,t){var f={nominal:t,amount:1},u=this.customerWallet.withdraw(f);return u===!0?(r.call(this).data("vending_machine").cashIn(f),i.call(this,"Deposit "+t)):i.call(this,"Can not withdrow "+u.nominal+": uderflow "+u.amountDiff),!1}function y(n,r){return r.result.status===t.PurcashingResult.prototype.SOLD_OK?(i.call(this,r.merch.name+"/"+r.merch.price+"R was purchased"),r.result.change&&(this.customerWallet.deposit(r.result.change),i.call(this,"Change refunded: "+this.customerWallet.getBalance(r.result.change)+"R"))):r.result.status===t.PurcashingResult.prototype.RUN_OUT?i.call(this,"Purchasing failed: selected goods item has finished"):r.result.status===t.PurcashingResult.prototype.NOT_ENOUGHT_MONEY?i.call(this,"Purchasing failed: the deposit is not enough"):r.result.status===t.PurcashingResult.prototype.NO_CHANGE&&i.call(this,"Purchasing failed: VM does not have enough change"),!1}function p(n,t){return this.customerWallet.deposit(t.items),i.call(this,"Money refunded: "+this.customerWallet.getBalance(t.items)+" R"),!1}function e(){return n(".id-user-wallet")}function w(){return n(".id-machine-wallet")}function r(){return n(".id-machine")}function b(){return n(".id-msg-log")}var h="SimulatorApp",o="VmSimulator",t=n[o]||(n[o]={}),c=t.SimulatorApp=function(n,t){this.modelUrl=n;this.templatesBaseUrl=t;this.logMessages=ko.observableArray()};c.prototype={run:function(){l.call(this);a.call(this)},clearLog:function(){this.logMessages([])}}}(window.jQuery);
//# sourceMappingURL=simulator-app.min.js.map