define("vending-machine-plugin",["jquery","wallet","goods-store","purcashing-result","knockoutjs"],function(n,t,i,r,u){"use strict";function w(n){var i=this,r=new t("opw","OperationWallet",[]);return{wallet:n.wallet,goods:n.goods,operationWallet:r,operationBalance:u.pureComputed(function(){return r.getBalance()}),status:u.observable(o),itemClick:function(n){nt.call(i,n)},refundClick:function(){tt.call(i)}}}function b(){function r(){h.call(t,!0)}function f(){h.call(t,!1)}function e(n){it.call(t).html(n);u.applyBindings(t.model,t.$element.get(0));k.call(t)}function o(n,i,r){t.$element.text("Can not load template - "+i+": '"+r+"'")}var t=this,i;rt.call(this).text(this.options.name);i={url:g.call(this),dataType:"html",beforeSend:r,type:"GET"};n.ajax(i).always(f).done(e).fail(o)}function k(){}function d(){}function g(){if(!this.options.goodsTemplate||typeof this.options.goodsTemplate!="string"||this.options.goodsTemplate.length==0)throw new Error("Plugin "+f+" can not recognize template, specified in options");return this.options.goodsTemplate}function h(t){t?this.$element.has(".list-ajax-loader").length==0&&n('<div class="list-ajax-loader" />').prependTo(this.$element):this.$element.find(".list-ajax-loader").remove()}function nt(n){var t=this.model.goods.purchase(n.name,this.model.operationWallet.getDetails());t.status===r.prototype.SOLD_OK?(this.model.operationWallet.withdrawAll(),this.model.status(o)):t.status===r.prototype.RUN_OUT?this.model.status(v):t.status===r.prototype.NOT_ENOUGHT_MONEY?this.model.status(a):this.model.status(y);this.$element.trigger("purchase-result",{result:t,merch:n})}function tt(){this.$element.trigger("money-refund",{items:this.model.operationWallet.withdrawAll()});this.model.status(o)}function it(){return this.$element.find(".id-goods")}function rt(){return this.$element.find(".id-machine-title")}function ut(){n.removeData(this.$element.get(0),f);this.$element.removeClass(f);d.call(this);this.$element=null}var c="VendingMachineP",f="vending_machine_p",o="Ready",l="Depositing",a="Deposit is not enough",v="Run out",y="No change",e=function(t,i){this.$element=n(t);this.options=i;this.model=w.call(this,i)},s;e.prototype={constructor:e,pluginName:f,getId:function(){return this.$element.attr("id")},cashIn:function(n){this.model.operationWallet.deposit(n);this.model.status(l)},destroy:function(){ut.call(this)}};n.fn[f]=function(t){var i=n.makeArray(arguments),r=i.slice(1);return this.each(function(){var u=n.data(this,f),o;return u?typeof t=="string"?u[t].apply(u,r):u.update&&u.update.apply(u,i):(o=n.extend({},n.fn[f].defaults,typeof t=="object"&&t),u=new e(this,o),b.call(u),n.data(this,f,u),n(this).addClass(f),typeof t=="string"&&u[t].apply(u,r)),!0})};n.fn[f].Constructor=e;s=n.fn[f].defaults={wallet:new t("m","MachineWallet",[]),goodsTemplate:"goods-template.html",id:"def1",name:"Vending Machine"};s.goods=new i([],s.wallet)});
//# sourceMappingURL=vending-machine-plugin.min.js.map