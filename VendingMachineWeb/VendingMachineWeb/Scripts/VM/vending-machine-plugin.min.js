!function(n){"use strict";function y(n){var t=this,r=new i.Wallet("opw","OperationWallet",[]);return{wallet:n.wallet,goods:n.goods,operationWallet:r,operationBalance:ko.pureComputed(function(){return r.getBalance()}),status:ko.observable(u),itemClick:function(n){d.call(t,n)},refundClick:function(){g.call(t)}}}function p(){function r(){o.call(t,!0)}function u(){o.call(t,!1)}function f(n){nt.call(t).html(n);ko.applyBindings(t.model,t.$element.get(0));w.call(t)}function e(n,i,r){t.$element.text("Can not load template - "+i+": '"+r+"'")}var t=this,i;tt.call(this).text(this.options.name);i={url:k.call(this),dataType:"html",beforeSend:r,type:"GET"};n.ajax(i).always(u).done(f).fail(e)}function w(){}function b(){}function k(){if(!this.options.goodsTemplate||typeof this.options.goodsTemplate!="string"||this.options.goodsTemplate.length==0)throw new Error("Plugin "+t+" can not recognize template, specified in options");return this.options.goodsTemplate}function o(t){t?this.$element.has(".list-ajax-loader").length==0&&n('<div class="list-ajax-loader" />').prependTo(this.$element):this.$element.find(".list-ajax-loader").remove()}function d(n){var t=this.model.goods.purchase(n.name,this.model.operationWallet.getDetails());t.status===i.PurcashingResult.prototype.SOLD_OK?(this.model.operationWallet.withdrawAll(),this.model.status(u)):t.status===i.PurcashingResult.prototype.RUN_OUT?this.model.status(l):t.status===i.PurcashingResult.prototype.NOT_ENOUGHT_MONEY?this.model.status(c):this.model.status(a);this.$element.trigger("purchase-result",{result:t,merch:n})}function g(){this.$element.trigger("money-refund",{items:this.model.operationWallet.withdrawAll()});this.model.status(u)}function nt(){return this.$element.find(".id-goods")}function tt(){return this.$element.find(".id-machine-title")}function it(){n.removeData(this.$element.get(0),t);this.$element.removeClass(t);b.call(this);this.$element=null}var s="VendingMachine",t="vending_machine",e="VmSimulator",i=n[e]||(n[e]={}),u="Ready",h="Depositing",c="Deposit is not enough",l="Run out",a="No change",r=function(t,i){this.$element=n(t);this.options=i;this.model=y.call(this,i)},f;r.prototype={constructor:r,pluginName:t,getId:function(){return this.$element.attr("id")},cashIn:function(n){this.model.operationWallet.deposit(n);this.model.status(h)},destroy:function(){it.call(this)}};n.fn[t]=function(i){var u=n.makeArray(arguments),f=u.slice(1);return this.each(function(){var e=n.data(this,t),o;return e?typeof i=="string"?e[i].apply(e,f):e.update&&e.update.apply(e,u):(o=n.extend({},n.fn[t].defaults,typeof i=="object"&&i),e=new r(this,o),p.call(e),n.data(this,t,e),n(this).addClass(t),typeof i=="string"&&e[i].apply(e,f)),!0})};n.fn[t].Constructor=r;f=n.fn[t].defaults={wallet:new i.Wallet("m","MachineWallet",[]),goodsTemplate:"goods-template.html",id:"def1",name:"Vending Machine"};f.goods=new i.GoodsStore([],f.wallet)}(window.jQuery);
//# sourceMappingURL=vending-machine-plugin.min.js.map